if (typeof(markethistory) === "undefined") {
  markethistory = {
      "data": [
        {
          "Year": 1976,
          "US_Stocks_SP500_TR": 0.23830999002106662,
          "Intl_Stocks_MSCI_EAFE_NR_USD": 0.0374,
          "US_Bonds_Agg_TR": 0.156
        },
        {
          "Year": 1977,
          "US_Stocks_SP500_TR": -0.06979704075935232,
          "Intl_Stocks_MSCI_EAFE_NR_USD": 0.1942,
          "US_Bonds_Agg_TR": 0.03
        },
        {
          "Year": 1978,
          "US_Stocks_SP500_TR": 0.0650928391167193,
          "Intl_Stocks_MSCI_EAFE_NR_USD": 0.34299999999999997,
          "US_Bonds_Agg_TR": 0.013999999999999999
        },
        {
          "Year": 1979,
          "US_Stocks_SP500_TR": 0.18519490167516386,
          "Intl_Stocks_MSCI_EAFE_NR_USD": 0.061799999999999994,
          "US_Bonds_Agg_TR": 0.019
        },
        {
          "Year": 1980,
          "US_Stocks_SP500_TR": 0.3173524550676301,
          "Intl_Stocks_MSCI_EAFE_NR_USD": 0.2443,
          "US_Bonds_Agg_TR": 0.027000000000000003
        },
        {
          "Year": 1981,
          "US_Stocks_SP500_TR": -0.04702390247495576,
          "Intl_Stocks_MSCI_EAFE_NR_USD": -0.0103,
          "US_Bonds_Agg_TR": 0.063
        },
        {
          "Year": 1982,
          "US_Stocks_SP500_TR": 0.20419055079559353,
          "Intl_Stocks_MSCI_EAFE_NR_USD": -0.0086,
          "US_Bonds_Agg_TR": 0.326
        },
        {
          "Year": 1983,
          "US_Stocks_SP500_TR": 0.22337155858930619,
          "Intl_Stocks_MSCI_EAFE_NR_USD": 0.24609999999999999,
          "US_Bonds_Agg_TR": 0.084
        },
        {
          "Year": 1984,
          "US_Stocks_SP500_TR": 0.0614614199963621,
          "Intl_Stocks_MSCI_EAFE_NR_USD": 0.0786,
          "US_Bonds_Agg_TR": 0.1515
        },
        {
          "Year": 1985,
          "US_Stocks_SP500_TR": 0.3123514948576895,
          "Intl_Stocks_MSCI_EAFE_NR_USD": 0.5672,
          "US_Bonds_Agg_TR": 0.2211
        },
        {
          "Year": 1986,
          "US_Stocks_SP500_TR": 0.18494578758046187,
          "Intl_Stocks_MSCI_EAFE_NR_USD": 0.6994,
          "US_Bonds_Agg_TR": 0.15259999999999999
        },
        {
          "Year": 1987,
          "US_Stocks_SP500_TR": 0.05812721641821871,
          "Intl_Stocks_MSCI_EAFE_NR_USD": 0.2493,
          "US_Bonds_Agg_TR": 0.0276
        },
        {
          "Year": 1988,
          "US_Stocks_SP500_TR": 0.16537192812044688,
          "Intl_Stocks_MSCI_EAFE_NR_USD": 0.2859,
          "US_Bonds_Agg_TR": 0.0789
        },
        {
          "Year": 1989,
          "US_Stocks_SP500_TR": 0.31475183638196724,
          "Intl_Stocks_MSCI_EAFE_NR_USD": 0.10800000000000001,
          "US_Bonds_Agg_TR": 0.14529999999999998
        },
        {
          "Year": 1990,
          "US_Stocks_SP500_TR": -0.03064451612903212,
          "Intl_Stocks_MSCI_EAFE_NR_USD": -0.23199999999999998,
          "US_Bonds_Agg_TR": 0.08960000000000001
        },
        {
          "Year": 1991,
          "US_Stocks_SP500_TR": 0.3023484313487976,
          "Intl_Stocks_MSCI_EAFE_NR_USD": 0.125,
          "US_Bonds_Agg_TR": 0.16
        },
        {
          "Year": 1992,
          "US_Stocks_SP500_TR": 0.07493727972380064,
          "Intl_Stocks_MSCI_EAFE_NR_USD": -0.1185,
          "US_Bonds_Agg_TR": 0.07400000000000001
        },
        {
          "Year": 1993,
          "US_Stocks_SP500_TR": 0.0996705147919488,
          "Intl_Stocks_MSCI_EAFE_NR_USD": 0.32939999999999997,
          "US_Bonds_Agg_TR": 0.0975
        },
        {
          "Year": 1994,
          "US_Stocks_SP500_TR": 0.013259206774573897,
          "Intl_Stocks_MSCI_EAFE_NR_USD": 0.0806,
          "US_Bonds_Agg_TR": -0.0292
        },
        {
          "Year": 1995,
          "US_Stocks_SP500_TR": 0.3719519890260631,
          "Intl_Stocks_MSCI_EAFE_NR_USD": 0.1155,
          "US_Bonds_Agg_TR": 0.18469999999999998
        },
        {
          "Year": 1996,
          "US_Stocks_SP500_TR": 0.2268096601886579,
          "Intl_Stocks_MSCI_EAFE_NR_USD": 0.0636,
          "US_Bonds_Agg_TR": 0.0363
        },
        {
          "Year": 1997,
          "US_Stocks_SP500_TR": 0.33103653103653097,
          "Intl_Stocks_MSCI_EAFE_NR_USD": 0.0206,
          "US_Bonds_Agg_TR": 0.0965
        },
        {
          "Year": 1998,
          "US_Stocks_SP500_TR": 0.28337953278443584,
          "Intl_Stocks_MSCI_EAFE_NR_USD": 0.20329999999999998,
          "US_Bonds_Agg_TR": 0.08689999999999999
        },
        {
          "Year": 1999,
          "US_Stocks_SP500_TR": 0.20885350992084475,
          "Intl_Stocks_MSCI_EAFE_NR_USD": 0.273,
          "US_Bonds_Agg_TR": -0.008199999999999999
        },
        {
          "Year": 2000,
          "US_Stocks_SP500_TR": -0.09031818955249278,
          "Intl_Stocks_MSCI_EAFE_NR_USD": -0.1396,
          "US_Bonds_Agg_TR": 0.11630000000000001
        },
        {
          "Year": 2001,
          "US_Stocks_SP500_TR": -0.11849759142000185,
          "Intl_Stocks_MSCI_EAFE_NR_USD": -0.2121,
          "US_Bonds_Agg_TR": 0.08439999999999999
        },
        {
          "Year": 2002,
          "US_Stocks_SP500_TR": -0.219660479579127,
          "Intl_Stocks_MSCI_EAFE_NR_USD": -0.1566,
          "US_Bonds_Agg_TR": 0.1026
        },
        {
          "Year": 2003,
          "US_Stocks_SP500_TR": 0.2835580005001023,
          "Intl_Stocks_MSCI_EAFE_NR_USD": 0.3917,
          "US_Bonds_Agg_TR": 0.040999999999999995
        },
        {
          "Year": 2004,
          "US_Stocks_SP500_TR": 0.10742775944096193,
          "Intl_Stocks_MSCI_EAFE_NR_USD": 0.207,
          "US_Bonds_Agg_TR": 0.0434
        },
        {
          "Year": 2005,
          "US_Stocks_SP500_TR": 0.048344775232688535,
          "Intl_Stocks_MSCI_EAFE_NR_USD": 0.1402,
          "US_Bonds_Agg_TR": 0.024300000000000002
        },
        {
          "Year": 2006,
          "US_Stocks_SP500_TR": 0.15612557979315703,
          "Intl_Stocks_MSCI_EAFE_NR_USD": 0.2686,
          "US_Bonds_Agg_TR": 0.0433
        },
        {
          "Year": 2007,
          "US_Stocks_SP500_TR": 0.054847352464217694,
          "Intl_Stocks_MSCI_EAFE_NR_USD": 0.11630000000000001,
          "US_Bonds_Agg_TR": 0.0697
        },
        {
          "Year": 2008,
          "US_Stocks_SP500_TR": -0.3655234411179819,
          "Intl_Stocks_MSCI_EAFE_NR_USD": -0.43060000000000004,
          "US_Bonds_Agg_TR": 0.0524
        },
        {
          "Year": 2009,
          "US_Stocks_SP500_TR": 0.2593523387766398,
          "Intl_Stocks_MSCI_EAFE_NR_USD": 0.3246,
          "US_Bonds_Agg_TR": 0.0593
        },
        {
          "Year": 2010,
          "US_Stocks_SP500_TR": 0.14821092278719414,
          "Intl_Stocks_MSCI_EAFE_NR_USD": 0.0821,
          "US_Bonds_Agg_TR": 0.0654
        },
        {
          "Year": 2011,
          "US_Stocks_SP500_TR": 0.0209837473362805,
          "Intl_Stocks_MSCI_EAFE_NR_USD": -0.1173,
          "US_Bonds_Agg_TR": 0.0784
        },
        {
          "Year": 2012,
          "US_Stocks_SP500_TR": 0.15890585241730293,
          "Intl_Stocks_MSCI_EAFE_NR_USD": 0.179,
          "US_Bonds_Agg_TR": 0.0421
        },
        {
          "Year": 2013,
          "US_Stocks_SP500_TR": 0.32145085858125483,
          "Intl_Stocks_MSCI_EAFE_NR_USD": 0.2329,
          "US_Bonds_Agg_TR": -0.0202
        },
        {
          "Year": 2014,
          "US_Stocks_SP500_TR": 0.13524421649462237,
          "Intl_Stocks_MSCI_EAFE_NR_USD": -0.044800000000000006,
          "US_Bonds_Agg_TR": 0.059699999999999996
        },
        {
          "Year": 2015,
          "US_Stocks_SP500_TR": 0.013788916411676138,
          "Intl_Stocks_MSCI_EAFE_NR_USD": -0.0039000000000000003,
          "US_Bonds_Agg_TR": 0.0055000000000000005
        },
        {
          "Year": 2016,
          "US_Stocks_SP500_TR": 0.11773080874798171,
          "Intl_Stocks_MSCI_EAFE_NR_USD": 0.0151,
          "US_Bonds_Agg_TR": 0.0265
        },
        {
          "Year": 2017,
          "US_Stocks_SP500_TR": 0.2160548143449928,
          "Intl_Stocks_MSCI_EAFE_NR_USD": 0.2562,
          "US_Bonds_Agg_TR": 0.0354
        },
        {
          "Year": 2018,
          "US_Stocks_SP500_TR": -0.04226869289088544,
          "Intl_Stocks_MSCI_EAFE_NR_USD": -0.1336,
          "US_Bonds_Agg_TR": 0.0001
        },
        {
          "Year": 2019,
          "US_Stocks_SP500_TR": 0.31211679996808755,
          "Intl_Stocks_MSCI_EAFE_NR_USD": 0.2266,
          "US_Bonds_Agg_TR": 0.0872
        },
        {
          "Year": 2020,
          "US_Stocks_SP500_TR": 0.18023201827422478,
          "Intl_Stocks_MSCI_EAFE_NR_USD": 0.0828,
          "US_Bonds_Agg_TR": 0.061
        },
        {
          "Year": 2021,
          "US_Stocks_SP500_TR": 0.2846885175196416,
          "Intl_Stocks_MSCI_EAFE_NR_USD": 0.11779999999999999,
          "US_Bonds_Agg_TR": -0.0154
        },
        {
          "Year": 2022,
          "US_Stocks_SP500_TR": -0.18037505927178585,
          "Intl_Stocks_MSCI_EAFE_NR_USD": -0.1401,
          "US_Bonds_Agg_TR": -0.1301
        },
        {
          "Year": 2023,
          "US_Stocks_SP500_TR": 0.26060684985024096,
          "Intl_Stocks_MSCI_EAFE_NR_USD": 0.1885,
          "US_Bonds_Agg_TR": 0.0553
        },
        {
          "Year": 2024,
          "US_Stocks_SP500_TR": 0.24878611262526726,
          "Intl_Stocks_MSCI_EAFE_NR_USD": 0.0435,
          "US_Bonds_Agg_TR": 0.0125
        }
      ],

      /**
       * Compute the arithmetic average (mean) return for an assetClass
       * between firstYear and lastYear (inclusive).
       * @param {number} firstYear
       * @param {number} lastYear
       * @param {string} assetClass - one of: "US_Stocks_SP500_TR", "Intl_Stocks_MSCI_EAFE_NR_USD", "US_Bonds_Agg_TR"
       * @returns {number|null} mean as a decimal (e.g., 0.07) or null if no data
       */
      getAverage(firstYear, lastYear, assetClass) {
        if (typeof firstYear !== 'number' || typeof lastYear !== 'number' || typeof assetClass !== 'string') {
          return null;
        }
        const a = Math.min(firstYear, lastYear);
        const b = Math.max(firstYear, lastYear);
        const values = this.data
          .filter(row => row.Year >= a && row.Year <= b)
          .map(row => Number(row[assetClass]))
          .filter(v => Number.isFinite(v));

        if (values.length === 0) return null;

        const sum = values.reduce((acc, v) => acc + v, 0);
        return sum / values.length;
      },

      /**
       * Compute the sample standard deviation of returns for an assetClass
       * between firstYear and lastYear (inclusive). Uses n-1 in the denominator.
       * @param {number} firstYear
       * @param {number} lastYear
       * @param {string} assetClass - one of: "US_Stocks_SP500_TR", "Intl_Stocks_MSCI_EAFE_NR_USD", "US_Bonds_Agg_TR"
       * @returns {number|null} sample standard deviation (decimal units) or null if <2 data points
       */
      getStandardDeviation(firstYear, lastYear, assetClass) {
        if (typeof firstYear !== 'number' || typeof lastYear !== 'number' || typeof assetClass !== 'string') {
          return null;
        }
        const a = Math.min(firstYear, lastYear);
        const b = Math.max(firstYear, lastYear);
        const values = this.data
          .filter(row => row.Year >= a && row.Year <= b)
          .map(row => Number(row[assetClass]))
          .filter(v => Number.isFinite(v));

        const n = values.length;
        if (n < 2) return null;

        const mean = values.reduce((acc, v) => acc + v, 0) / n;
        const variance = values.reduce((acc, v) => acc + Math.pow(v - mean, 2), 0) / (n - 1);
        return Math.sqrt(variance);
      }
  }
}
